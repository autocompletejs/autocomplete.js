// Autocomplete.js v1.4.0 unstable | Under MIT Licence | 2014 Baptiste Donaux
"use strict";function Attr(e,t){if(typeof t=="string"){return e.getAttribute(t)}for(var n in t){e.setAttribute(n,t[n])}}function DOMCreate(e){return document.createElement(e)}function Merge(e,t){var n={};for(var r in e){n[r]=e[r]}for(var i in t){n[i]=t[i]}return n}var AutoComplete=function(e){if(this){this._args=e;this._custArgs=[];this.Init();for(var t=this._args.selector.length-1;t>=0;t--){this.BindCollection(this._args.selector[t])}}else{new AutoComplete(e)}};AutoComplete.prototype={Ajax:function(e,t,n,r,i){if(e){e.abort()}var s=t.method,o=t.url;if(s.match(/^GET$/i)){o+="?"+n}e=new XMLHttpRequest;e.open(s,o,true);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.onreadystatechange=function(){if(e.readyState==4&&e.status==200){if(t.post(i,e.response,t)!==true){t.open(r,i)}}};e.send(n);return e},BindCollection:function(e){var t,n=document.querySelectorAll(e);for(var r=n.length-1;r>=0;r--){t=n[r];if(t.nodeName.match(/^INPUT$/i)&&t.type.match(/^TEXT$/i)){this.BindOne(t)}}},BindOne:function(e){if(e){var t="data-autocomplete-old-value",n=this,r=DOMCreate("div"),i;Attr(e,{autocomplete:"off"});n.Position(e,r);e.addEventListener("autocomplete:position",function(){n.Position(e,r)});e.parentNode.appendChild(r);e.addEventListener("focus",function(){var n=Attr(e,t);if(!n||e.value!=n){Attr(r,{"class":"autocomplete open"})}});e.addEventListener("blur",function(){n.Close(r)});e.addEventListener("keyup",function(e){var s=e.currentTarget,o=n.CustParams(s),u=o.pre(s);if(u&&o.url){var a=Attr(s,t);if(!a||u!=a){Attr(r,{"class":"autocomplete open"})}i=n.Ajax(i,o,o.paramName+"="+u,s,r)}})}},Close:function(e,t){var n=this;if(t){Attr(e,{"class":"autocomplete"})}else{setTimeout(function(){n.Close(e,true)},150)}},CreateCustParams:function(e){var t={limit:"data-autocomplete-limit",method:"data-autocomplete-method",noResult:"data-autocomplete-no-result",paramName:"data-autocomplete-param-name",url:"data-autocomplete"},n=this;var r=Object.getOwnPropertyNames(t);for(var i=r.length-1;i>=0;i--){t[r[i]]=Attr(e,t[r[i]])}for(var s in t){if(t.hasOwnProperty(s)&&!t[s]){delete t[s]}}if(t.method&&!t.method.match(/^GET|POST$/i)){delete t.method}if(t.limit){if(isNaN(t.limit)){delete t.limit}else{t.limit=parseInt(t.limit)}}return Merge(n._args,t)},CustParams:function(e){var t="data-autocomplete-id",n=this;if(!e.hasAttribute(t)){e.setAttribute(t,n._custArgs.length);n._custArgs.push(n.CreateCustParams(e))}return n._custArgs[Attr(e,t)]},Init:function(){var e=this,t={limit:0,method:"GET",noResult:"No result",paramName:"q",open:function(e,t){var n=function(t){t.addEventListener("click",function(t){var n=t.currentTarget,r="data-autocomplete-value";e.value=n.hasAttribute(r)?Attr(n,r):n.innerHTML;Attr(e,{"data-autocomplete-old-value":e.value})})};var r=t.getElementsByTagName("li");for(var i=r.length-1;i>=0;i--){n(r[i])}},post:function(e,t,n){try{t=JSON.parse(t);var r,i=t.length,s=DOMCreate("li"),o=DOMCreate("ul");if(Array.isArray(t)){if(i){if(n.limit<0){t.reverse()}for(var u=0;u<i&&(u<Math.abs(n.limit)||!n.limit);u++){s.innerHTML=t[u];o.appendChild(s);s=DOMCreate("li")}}else{r=true;Attr(s,{"class":"locked"});s.innerHTML=n.noResult;o.appendChild(s)}}else{var a=Object.getOwnPropertyNames(t);if(n.limit<0){a.reverse()}for(var f in a){if(parseInt(f)<Math.abs(n.limit)||!n.limit){s.innerHTML=t[a[f]];Attr(s,{"data-autocomplete-value":a[f]});o.appendChild(s);s=DOMCreate("li")}}}if(e.hasChildNodes()){e.childNodes[0].remove()}e.appendChild(o);return r}catch(l){e.innerHTML=t}},pre:function(e){return e.value},selector:["input[data-autocomplete]"]};if(e._args===undefined){e._args={}}e._args=Merge(t,e._args);if(!e._args.method.match(/^GET|POST$/i)){e._args.method=t.method}if(!Array.isArray(e._args.selector)){e._args.selector=t.selector}},Position:function(e,t){Attr(t,{"class":"autocomplete",style:"top:"+(e.offsetTop+e.offsetHeight)+"px;left:"+e.offsetLeft+"px;width:"+e.clientWidth+"px;"})}};